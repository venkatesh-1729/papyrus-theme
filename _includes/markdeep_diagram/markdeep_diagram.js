function escapeHTMLEntities(a){return String(a).rp(/&/g,"&amp;").rp(/</g,"&lt;").rp(/>/g,"&gt;").rp(/"/g,"&quot;")}function equalizeLineLengths(a){var b=a.split("\n"),c=0;b.forEach(function(a){c=max(c,a.length)});var d=Array(c+1).join(" "),e="";return b.forEach(function(a){e+=a+d.ss(a.length)+"\n"}),e}function extractDiagram(a){function b(){j=a.indexOf("\n",e)+1,k=k||/\S/.test(a.ss(e,e+f)),l=l||/\S/.test(a.ss(e+h+1,j))}for(var c={beforeString:a,diagramString:"",alignmentHint:"",afterString:""},d=a.indexOf(DIAGRAM_START);d>=0;d=a.indexOf(DIAGRAM_START,d+DIAGRAM_START.length)){var g,e=max(0,a.lastIndexOf("\n",d))+1,f=d-e;for(g=d+DIAGRAM_START.length;a[g]===DIAGRAM_MARKER;++g);var h=g-e-1,i={beforeString:a.ss(0,e),diagramString:"",alignmentHint:"center",afterString:a.ss(e,d).rp(/[ \t]+$/," ")},j=0,k=!1,l=!1;b();for(var m=!0,n=g;m;){if(e=j,b(),0===e)return c;if(k?i.alignmentHint="floatright":l&&(i.alignmentHint="floatleft"),a[e+f]===DIAGRAM_MARKER&&a[e+h]===DIAGRAM_MARKER){for(var o=f;o<h&&a[e+o]===DIAGRAM_MARKER;++o);var p=e+f,q=e+h;if(i.afterString+=a.ss(n,p).rp(/^[ \t]*[ \t]/," ").rp(/[ \t][ \t]*$/," "),o===h)return i.afterString+=a.ss(e+h+1),i;i.diagramString+=a.ss(p+1,q)+"\n",n=q+1}else m=!1}}return c}function unescapeHTMLEntities(a){return a.rp(/&lt;/g,"<").rp(/&gt;/g,">").rp(/&quot;/g,'"').rp(/&#39;/g,"'").rp(/&ndash;/g,"–").rp(/&mdash;/g,"---").rp(/&amp;/g,"&")}function replaceDiagrams(a){a=unescapeHTMLEntities(a);var b=extractDiagram(a);if(b.diagramString){var c=/^\n*[ \t]*\[[^\n]+\][ \t]*(?=\n)/;b.afterString=b.afterString.rp(c,function(a){return a=a.trim(),a=a.ss(1,a.length-1),entag("center",entag("div",a,protect('class="imagecaption"')))});var d=diagramToSVG(b.diagramString,b.alignmentHint);return b.beforeString+d+"\n"+replaceDiagrams(b.afterString)}return a}function diagramToSVG(a,b){function p(a){return k.indexOf(a)+1}function q(a){return l.indexOf(a)!==-1}function r(a){return p(a)||"."===a}function s(a){return p(a)||"'"===a}function t(a){return q(a)||"<"===a||E(a)}function u(a){return q(a)||">"===a||E(a)}function w(a){return m.indexOf(a)+1}function x(a){return n.indexOf(a)+1}function y(a){return"-"===a||p(a)||D(a)}function z(a){return A(a)||D(a)||E(a)}function A(a){return"|"===a||p(a)}function B(a){return"/"===a||p(a)}function C(a){return"\\"===a||p(a)}function D(a){return j.indexOf(a)+1}function E(a){return i.indexOf(a)+1}function F(a){return o.indexOf(a)+1}function H(a,b){return this instanceof H?(void 0===b&&(void 0===a?a=b=0:a instanceof H?(b=a.y,a=a.x):console.error("Vec2 requires one Vec2 or (x, y) as an argument")),this.x=a,this.y=b,void Object.seal(this)):new H(a,b)}function I(a){var b=function(c,d){return void 0===d&&(c instanceof H?(d=c.y,c=c.x):console.error("grid requires either a Vec2 or (x, y)")),c>=0&&c<b.width&&d>=0&&d<b.height?a[d*(b.width+1)+c]:" "};return b._used=[],b.width=a.indexOf("\n"),b.height=a.split("\n").length,"\n"===a[a.length-1]&&--b.height,b.setUsed=function(a,c){void 0===c&&(a instanceof H?(c=a.y,a=a.x):console.error("grid requires either a Vec2 or (x, y)")),a>=0&&a<b.width&&c>=0&&c<b.height&&(b._used[c*(b.width+1)+a]=!0)},b.isUsed=function(a,b){return void 0===b&&(a instanceof H?(b=a.y,a=a.x):console.error("grid requires either a Vec2 or (x, y)")),this._used[b*(this.width+1)+a]===!0},b.isSolidVLineAt=function(a,c){void 0===c&&(c=a.x,a=a.x);var d=b(a,c-1),e=b(a,c),f=b(a,c+1),g=b(a+1,c-1),h=b(a-1,c-1);return A(e)?r(d)||"^"===d||A(d)||D(d)||s(f)||"v"===f||A(f)||D(f)||E(d)||E(f)||"_"===b(a,c-1)||"_"===h||"_"===g||(r(h)||r(g))&&(s(b(a-1,c+1))||s(b(a+1,c+1))):r(e)||"^"===e?A(f)||D(f)&&"."!==e:s(e)||"v"===e?A(d)||D(d)&&"'"!==e:!!E(e)&&(A(d)||A(f))},b.isSolidHLineAt=function(a,c){void 0===c&&(c=a.x,a=a.x);var d=b(a-2,c),e=b(a-1,c),f=b(a+0,c),g=b(a+1,c),h=b(a+2,c);return y(f)||y(e)&&D(f)?y(e)?y(g)||u(g)||y(d)||t(d):t(e)?y(g):y(g)&&(y(h)||u(h)):"<"===f?y(g)&&y(h):">"===f?y(e)&&y(d):!!q(f)&&(y(e)&&y(d)||y(g)&&y(h))},b.isSolidBLineAt=function(a,c){void 0===c&&(c=a.x,a=a.x);var d=b(a,c),e=b(a-1,c-1),f=b(a+1,c+1);return"\\"===d?C(f)||s(f)||E(f)||"v"===f||C(e)||r(e)||E(e)||"^"===e||"/"===b(a,c-1)||"/"===b(a,c+1)||"_"===f||"_"===e:"."===d?"\\"===f:"'"===d?"\\"===e:"^"===d?"\\"===f:"v"===d?"\\"===e:q(d)||E(d)||"|"===d?C(e)||C(f):void 0},b.isSolidDLineAt=function(a,c){void 0===c&&(c=a.x,a=a.x);var d=b(a,c),e=b(a-1,c+1),f=b(a+1,c-1);return"/"===d&&("\\"===b(a,c-1)||"\\"===b(a,c+1))||(B(d)?B(f)||r(f)||E(f)||"^"===f||"_"===f||B(e)||s(e)||E(e)||"v"===e||"_"===e:"."===d?"/"===e:"'"===d?"/"===f:"^"===d?"/"===e:"v"===d?"/"===f:!(!q(d)&&!E(d)&&"|"!==d)&&(B(e)||B(f)))},b.toString=function(){return a},Object.freeze(b)}function J(a,b,c,d,e){a instanceof H&&b instanceof H||console.error("Path constructor requires at least two Vec2s"),this.A=a,this.B=b,c&&(this.C=c,d?this.D=d:this.D=c),this.dashed=e||!1,Object.freeze(this)}function L(){this._pathArray=[]}function N(a){return function(b,c){for(var d=0;d<this._pathArray.length;++d)if(a.call(this._pathArray[d],b,c))return!0;return!1}}function O(){this._decorationArray=[]}function Q(a,b){function c(b,c,d){var g,h,e=sign(c.x-b.x),f=sign(c.y-b.y);for(g=b.x,h=b.y;g!==c.x||h!==c.y;g+=e,h+=f)if(a(g,h)===d)return!0;return a(g,h)===d}for(var d=0;d<a.width;++d)for(var e=0;e<a.height;++e)if(a.isSolidVLineAt(d,e)){var f=H(d,e);do a.setUsed(d,e),++e;while(a.isSolidVLineAt(d,e));var g=H(d,e-1),h=a(f),i=a(f.x,f.y-1);(!q(h)&&("-"===i||"_"===i||"_"===a(f.x-1,f.y-1)||"_"===a(f.x+1,f.y-1)||s(i))||D(i))&&(f.y-=.5);var j=a(g),k=a(g.x,g.y+1);(!q(j)&&("-"===k||r(k))||D(k)||"_"===a(g.x-1,g.y)||"_"===a(g.x+1,g.y))&&(g.y+=.5),f.x===g.x&&f.y===g.y||b.insert(new J(f,g))}else"'"===a(d,e)&&("-"===a(d-1,e)&&"_"===a(d+1,e-1)&&!z(a(d-1,e-1))||"_"===a(d-1,e-1)&&"-"===a(d+1,e)&&!z(a(d+1,e-1)))?b.insert(new J(H(d,e-.5),H(d,e))):"."===a(d,e)&&("_"===a(d-1,e)&&"-"===a(d+1,e)&&!z(a(d+1,e+1))||"-"===a(d-1,e)&&"_"===a(d+1,e)&&!z(a(d-1,e+1)))&&b.insert(new J(H(d,e),H(d,e+.5)));for(var e=0;e<a.height;++e)for(var d=0;d<a.width;++d)if(a.isSolidHLineAt(d,e)){var f=H(d,e);do a.setUsed(d,e),++d;while(a.isSolidHLineAt(d,e));var g=H(d-1,e);!q(a(f.x-1,f.y))&&(r(a(f))&&z(a(f.x-1,f.y+1))||s(a(f))&&z(a(f.x-1,f.y-1)))&&++f.x,!q(a(g.x+1,g.y))&&(r(a(g))&&z(a(g.x+1,g.y+1))||s(a(g))&&z(a(g.x+1,g.y-1)))&&--g.x,f.x===g.x&&f.y===g.y||b.insert(new J(f,g))}for(var l=-a.height;l<a.width;++l)for(var d=l,e=0;e<a.height;++e,++d)if(a.isSolidBLineAt(d,e)){var f=H(d,e);do++d,++e;while(a.isSolidBLineAt(d,e));var g=H(d-1,e-1);if(c(f,g,"\\")){for(var m=f.x;m<=g.x;++m)a.setUsed(m,f.y+(m-f.x));var n=a(f),h=a(f.x,f.y-1),o=a(f.x-1,f.y-1);"/"===h||"_"===o||"_"===h||!q(n)&&(y(o)||A(o))?(f.x-=.5,f.y-=.5):E(o)&&(f.x-=.25,f.y-=.25);var t=(a(g),a(g.x+1,g.y+1));"/"===a(g.x,g.y+1)||"_"===a(g.x+1,g.y)||"_"===a(g.x-1,g.y)||!q(a(g))&&(y(t)||A(t))?(g.x+=.5,g.y+=.5):E(t)&&(g.x+=.25,g.y+=.25),b.insert(new J(f,g))}}for(var l=-a.height;l<a.width;++l)for(var d=l,e=a.height-1;e>=0;--e,++d)if(a.isSolidDLineAt(d,e)){var f=H(d,e);do++d,--e;while(a.isSolidDLineAt(d,e));var g=H(d-1,e+1);if(c(f,g,"/")){for(var m=f.x;m<=g.x;++m)a.setUsed(m,f.y-(m-f.x));var h=a(g.x,g.y-1),u=a(g.x+1,g.y-1);a(g);"\\"===h||"_"===h||"_"===u||!q(a(g))&&(y(u)||A(u))?(g.x+=.5,g.y-=.5):E(u)&&(g.x+=.25,g.y-=.25);var v=a(f.x-1,f.y+1),n=a(f);"\\"===a(f.x,f.y+1)||"_"===a(f.x-1,f.y)||"_"===a(f.x+1,f.y)||!q(a(f))&&(y(v)||A(v))?(f.x-=.5,f.y+=.5):E(v)&&(f.x-=.25,f.y+=.25),b.insert(new J(f,g))}}for(var e=0;e<a.height;++e)for(var d=0;d<a.width;++d){var w=a(d,e);r(w)&&(y(a(d-1,e))&&A(a(d+1,e+1))&&(a.setUsed(d-1,e),a.setUsed(d,e),a.setUsed(d+1,e+1),b.insert(new J(H(d-1,e),H(d+1,e+1),H(d+1.1,e),H(d+1,e+1)))),y(a(d+1,e))&&A(a(d-1,e+1))&&(a.setUsed(d-1,e+1),a.setUsed(d,e),a.setUsed(d+1,e),b.insert(new J(H(d+1,e),H(d-1,e+1),H(d-1.1,e),H(d-1,e+1))))),")"!==w&&!E(w)||"."!==a(d-1,e-1)||"'"!==a(d-1,e+1)||(a.setUsed(d,e),a.setUsed(d-1,e-1),a.setUsed(d-1,e+1),b.insert(new J(H(d-2,e-1),H(d-2,e+1),H(d+.6,e-1),H(d+.6,e+1)))),"("!==w&&!E(w)||"."!==a(d+1,e-1)||"'"!==a(d+1,e+1)||(a.setUsed(d,e),a.setUsed(d+1,e-1),a.setUsed(d+1,e+1),b.insert(new J(H(d+2,e-1),H(d+2,e+1),H(d-.6,e-1),H(d-.6,e+1)))),s(w)&&(y(a(d-1,e))&&A(a(d+1,e-1))&&(a.setUsed(d-1,e),a.setUsed(d,e),a.setUsed(d+1,e-1),b.insert(new J(H(d-1,e),H(d+1,e-1),H(d+1.1,e),H(d+1,e-1)))),y(a(d+1,e))&&A(a(d-1,e-1))&&(a.setUsed(d-1,e-1),a.setUsed(d,e),a.setUsed(d+1,e),b.insert(new J(H(d+1,e),H(d-1,e-1),H(d-1.1,e),H(d-1,e-1)))))}for(var e=0;e<a.height;++e)for(var d=0;d<a.width-2;++d){var x=a(d-1,e);if(!("_"!==a(d,e)||"_"!==a(d+1,e)||isASCIILetter(a(d+2,e))&&"_"!==x||isASCIILetter(x)&&"_"!==a(d+2,e))){var B=a(d-2,e),f=H(d-.5,e+.5);"|"===x||"|"===a(d-1,e+1)||"."===x||"'"===a(d-1,e+1)?(f.x-=.5,"."!==x||"-"!==B&&"."!==B||"("!==a(d-2,e+1)||(f.x-=.5)):"/"===x&&(f.x-=1),"("===x&&"("===B&&"'"===a(d,e+1)&&"."===a(d,e-1)&&(f.x+=.5),x=B=void 0;do a.setUsed(d,e),++d;while("_"===a(d,e));var g=H(d-.5,e+.5),w=a(d,e),C=a(d+1,e),j=a(d,e+1);"|"===w||"|"===j||"."===w||"'"===j?(g.x+=.5,"."!==w||"-"!==C&&"."!==C||")"!==a(d+1,e+1)||(g.x+=.5)):"\\"===w&&(g.x+=1),")"===w&&")"===C&&"'"===a(d-1,e+1)&&"."===a(d-1,e-1)&&(g.x+=-.5),b.insert(new J(f,g))}}}function R(a,b,c){function d(a){return" "===a||/[^a-zA-Z0-9]|[ov]/.test(a)}function e(a,b,c,e){return(d(b)||E(b))&&(d(a)||E(a))&&d(e)&&d(c)}for(var g=0;g<a.width;++g)for(var h=0;h<a.height;++h){var i=a(g,h),j=h;if(D(i))b.downEndsAt(g,j-.5)&&b.upEndsAt(g,j+.5)&&(c.insert(g,j,i),a.setUsed(g,j));else if(E(i)){var k=a(g,j-1),l=a(g,j+1),m=a(g-1,j),n=a(g+1,j);(b.rightEndsAt(g-1,j)||b.leftEndsAt(g+1,j)||b.downEndsAt(g,j-1)||b.upEndsAt(g,j+1)||b.upEndsAt(g,j)||b.downEndsAt(g,j)||e(k,l,m,n))&&(c.insert(g,j,i),a.setUsed(g,j))}else if(w(i))c.insert(g,j,i),a.setUsed(g,j);else if(x(i))c.insert(g,j,i),a.setUsed(g,j);else{var o=0;">"===i&&(b.rightEndsAt(g,j)||b.horizontalPassesThrough(g,j))?(E(a(g+1,j))&&(o=-.5),c.insert(g+o,j,">",0),a.setUsed(g,j)):"<"===i&&(b.leftEndsAt(g,j)||b.horizontalPassesThrough(g,j))?(E(a(g-1,j))&&(o=.5),c.insert(g+o,j,">",180),a.setUsed(g,j)):"^"===i?b.upEndsAt(g,j-.5)?(c.insert(g,j-.5,">",270),a.setUsed(g,j)):b.upEndsAt(g,j)?(c.insert(g,j,">",270),a.setUsed(g,j)):b.diagonalUpEndsAt(g+.5,j-.5)?(c.insert(g+.5,j-.5,">",270+f),a.setUsed(g,j)):b.diagonalUpEndsAt(g+.25,j-.25)?(c.insert(g+.25,j-.25,">",270+f),a.setUsed(g,j)):b.diagonalUpEndsAt(g,j)?(c.insert(g,j,">",270+f),a.setUsed(g,j)):b.backDiagonalUpEndsAt(g,j)?(c.insert(g,j,i,270-f),a.setUsed(g,j)):b.backDiagonalUpEndsAt(g-.5,j-.5)?(c.insert(g-.5,j-.5,i,270-f),a.setUsed(g,j)):b.backDiagonalUpEndsAt(g-.25,j-.25)?(c.insert(g-.25,j-.25,i,270-f),a.setUsed(g,j)):b.verticalPassesThrough(g,j)&&(c.insert(g,j-.5,">",270),a.setUsed(g,j)):"v"===i&&(b.downEndsAt(g,j+.5)?(c.insert(g,j+.5,">",90),a.setUsed(g,j)):b.downEndsAt(g,j)?(c.insert(g,j,">",90),a.setUsed(g,j)):b.diagonalDownEndsAt(g,j)?(c.insert(g,j,">",90+f),a.setUsed(g,j)):b.diagonalDownEndsAt(g-.5,j+.5)?(c.insert(g-.5,j+.5,">",90+f),a.setUsed(g,j)):b.diagonalDownEndsAt(g-.25,j+.25)?(c.insert(g-.25,j+.25,">",90+f),a.setUsed(g,j)):b.backDiagonalDownEndsAt(g,j)?(c.insert(g,j,">",90-f),a.setUsed(g,j)):b.backDiagonalDownEndsAt(g+.5,j+.5)?(c.insert(g+.5,j+.5,">",90-f),a.setUsed(g,j)):b.backDiagonalDownEndsAt(g+.25,j+.25)?(c.insert(g+.25,j+.25,">",90-f),a.setUsed(g,j)):b.verticalPassesThrough(g,j)&&(c.insert(g,j+.5,">",90),a.setUsed(g,j)))}}}a=equalizeLineLengths(a);var c="";a=a.rp(/([a-z]|[A-Z])o([a-z]|[A-Z])/g,"$1"+c+"$2");var d=8,e=2,f=180*Math.atan(1/e)/Math.PI,g=1e-6,h=">v<^",i="o*",j="()",k="+",l=k+".'",m="░▒▓▔▉",n="◢◣◤◥",o=h+i+j+m+n;H.prototype.toString=H.prototype.toSVG=function(){return""+this.x*d+","+this.y*d*e+" "};var K=J.prototype;K.isVertical=function(){return this.B.x===this.A.x},K.isHorizontal=function(){return this.B.y===this.A.y},K.isDiagonal=function(){var a=this.B.x-this.A.x,b=this.B.y-this.A.y;return abs(b+a)<g},K.isBackDiagonal=function(){var a=this.B.x-this.A.x,b=this.B.y-this.A.y;return abs(b-a)<g},K.isCurved=function(){return void 0!==this.C},K.endsAt=function(a,b){return void 0===b&&(b=a.y,a=a.x),this.A.x===a&&this.A.y===b||this.B.x===a&&this.B.y===b},K.upEndsAt=function(a,b){return void 0===b&&(b=a.y,a=a.x),this.isVertical()&&this.A.x===a&&min(this.A.y,this.B.y)===b},K.diagonalUpEndsAt=function(a,b){return!!this.isDiagonal()&&(void 0===b&&(b=a.y,a=a.x),this.A.y<this.B.y?this.A.x===a&&this.A.y===b:this.B.x===a&&this.B.y===b)},K.diagonalDownEndsAt=function(a,b){return!!this.isDiagonal()&&(void 0===b&&(b=a.y,a=a.x),this.B.y<this.A.y?this.A.x===a&&this.A.y===b:this.B.x===a&&this.B.y===b)},K.backDiagonalUpEndsAt=function(a,b){return!!this.isBackDiagonal()&&(void 0===b&&(b=a.y,a=a.x),this.A.y<this.B.y?this.A.x===a&&this.A.y===b:this.B.x===a&&this.B.y===b)},K.backDiagonalDownEndsAt=function(a,b){return!!this.isBackDiagonal()&&(void 0===b&&(b=a.y,a=a.x),this.B.y<this.A.y?this.A.x===a&&this.A.y===b:this.B.x===a&&this.B.y===b)},K.downEndsAt=function(a,b){return void 0===b&&(b=a.y,a=a.x),this.isVertical()&&this.A.x===a&&max(this.A.y,this.B.y)===b},K.leftEndsAt=function(a,b){return void 0===b&&(b=a.y,a=a.x),this.isHorizontal()&&this.A.y===b&&min(this.A.x,this.B.x)===a},K.rightEndsAt=function(a,b){return void 0===b&&(b=a.y,a=a.x),this.isHorizontal()&&this.A.y===b&&max(this.A.x,this.B.x)===a},K.verticalPassesThrough=function(a,b){return void 0===b&&(b=a.y,a=a.x),this.isVertical()&&this.A.x===a&&min(this.A.y,this.B.y)<=b&&max(this.A.y,this.B.y)>=b},K.horizontalPassesThrough=function(a,b){return void 0===b&&(b=a.y,a=a.x),this.isHorizontal()&&this.A.y===b&&min(this.A.x,this.B.x)<=a&&max(this.A.x,this.B.x)>=a},K.toSVG=function(){var a='<path d="M '+this.A;return a+=this.isCurved()?"C "+this.C+this.D+this.B:"L "+this.B,a+='" style="fill:none;"',this.dashed&&(a+=' stroke-dasharray="3,6"'),a+="/>"};var M=L.prototype;M.insert=function(a){this._pathArray.push(a)},M.upEndsAt=N(K.upEndsAt),M.diagonalUpEndsAt=N(K.diagonalUpEndsAt),M.backDiagonalUpEndsAt=N(K.backDiagonalUpEndsAt),M.diagonalDownEndsAt=N(K.diagonalDownEndsAt),M.backDiagonalDownEndsAt=N(K.backDiagonalDownEndsAt),M.downEndsAt=N(K.downEndsAt),M.leftEndsAt=N(K.leftEndsAt),M.rightEndsAt=N(K.rightEndsAt),M.endsAt=N(K.endsAt),M.verticalPassesThrough=N(K.verticalPassesThrough),M.horizontalPassesThrough=N(K.horizontalPassesThrough),M.toSVG=function(){for(var a="",b=0;b<this._pathArray.length;++b)a+=this._pathArray[b].toSVG()+"\n";return a};var P=O.prototype;P.insert=function(a,b,c,d){void 0===c&&(c=b,b=a.y,a=a.x),F(c)||console.error("Illegal decoration character: "+c);var e={C:H(a,b),type:c,angle:d||0};E(c)?this._decorationArray.push(e):this._decorationArray.unshift(e)},P.toSVG=function(){for(var a="",b=0;b<this._decorationArray.length;++b){var c=this._decorationArray[b],f=c.C;if(D(c.type)){var g=")"===c.type?.75:-.75,h=H(f.x,f.y-.5),i=H(f.x,f.y+.5),j=H(f.x+g,f.y-.5),k=H(f.x+g,f.y+.5);a+='<path d="M '+i+" C "+k+j+h+'" style="fill:none;"/>'}else if(E(c.type))a+='<circle cx="'+f.x*d+'" cy="'+f.y*d*e+'" r="'+(d-STROKE_WIDTH)+'" class="'+("*"===c.type?"closed":"open")+'dot"/>';else if(w(c.type)){var l=Math.round(63.75*(3-m.indexOf(c.type)));a+='<rect x="'+(f.x-.5)*d+'" y="'+(f.y-.5)*d*e+'" width="'+d+'" height="'+d*e+'" fill="rgb('+l+","+l+","+l+')"/>'}else if(x(c.type)){var o=n.indexOf(c.type),p=.5-(1&o),q=.5-(o>>1);p*=sign(q);var r=H(f.x+p,f.y-q),h=H(f.x+p,f.y+q),i=H(f.x-p,f.y+q);a+='<polygon points="'+r+h+i+'" style="stroke:none"/>\n'}else{var r=H(f.x+1,f.y),h=H(f.x-.5,f.y-.35),i=H(f.x-.5,f.y+.35);a+='<polygon points="'+r+h+i+'"  style="stroke:none" transform="rotate('+c.angle+","+f+')"/>\n'}}return a};var S=I(a),T=new L,U=new O;Q(S,T),R(S,T,U);var V='<svg class="diagram" xmlns="http://www.w3.org/2000/svg" version="1.1" height="'+(S.height+1)*d*e+'" width="'+(S.width+1)*d+'"';if("floatleft"===b?V+=' style="float:left;margin:15px 30px 15px 0;"':"floatright"===b?V+=' style="float:right;margin:15px 0 15px 30px;"':"center"===b&&(V+=' style="margin:0 auto 0 auto;"'),V+='><g transform="translate('+H(1,1)+')">\n',DEBUG_SHOW_GRID){V+='<g style="opacity:0.1">\n';for(var W=0;W<S.width;++W)for(var X=0;X<S.height;++X)V+='<rect x="'+((W-.5)*d+1)+'" + y="'+((X-.5)*d*e+2)+'" width="'+(d-2)+'" height="'+(d*e-2)+'" style="fill:',V+=S.isUsed(W,X)?"red;":" "===S(W,X)?"gray;opacity:0.05":"blue;",V+='"/>\n';V+="</g>\n"}if(V+=T.toSVG(),V+=U.toSVG(),!DEBUG_HIDE_PASSTHROUGH){V+='<g transform="translate(0,0)">';for(var X=0;X<S.height;++X)for(var W=0;W<S.width;++W){var Y=S(W,X);/[\u2B22\u2B21]/.test(Y)?V+='<text text-anchor="middle" x="'+W*d+'" y="'+(4+X*d*e)+'" style="font-size:20.5px">'+escapeHTMLEntities(Y)+"</text>":" "===Y||S.isUsed(W,X)||(V+='<text text-anchor="middle" x="'+W*d+'" y="'+(4+X*d*e)+'">'+escapeHTMLEntities(Y)+"</text>")}V+="</g>"}if(DEBUG_SHOW_SOURCE){V+='<g transform="translate(2,2)">\n';for(var W=0;W<S.width;++W)for(var X=0;X<S.height;++X){var Y=S(W,X);" "!==Y&&(V+='<text text-anchor="middle" x="'+W*d+'" y="'+(4+X*d*e)+'" style="fill:#F00;font-family:Menlo,monospace;font-size:12px;text-align:center">'+escapeHTMLEntities(Y)+"</text>")}V+="</g>"}return V+="</g></svg>",V=V.rp(new RegExp(c,"g"),"o")}function findPaths(a,b){function c(b,c,d){var g,h,e=sign(c.x-b.x),f=sign(c.y-b.y);for(g=b.x,h=b.y;g!==c.x||h!==c.y;g+=e,h+=f)if(a(g,h)===d)return!0;return a(g,h)===d}for(var d=0;d<a.width;++d)for(var e=0;e<a.height;++e)if(a.isSolidVLineAt(d,e)){var f=Vec2(d,e);do a.setUsed(d,e),++e;while(a.isSolidVLineAt(d,e));var g=Vec2(d,e-1),h=a(f),i=a(f.x,f.y-1);(!isVertex(h)&&("-"===i||"_"===i||"_"===a(f.x-1,f.y-1)||"_"===a(f.x+1,f.y-1)||isBottomVertex(i))||isJump(i))&&(f.y-=.5);var j=a(g),k=a(g.x,g.y+1);(!isVertex(j)&&("-"===k||isTopVertex(k))||isJump(k)||"_"===a(g.x-1,g.y)||"_"===a(g.x+1,g.y))&&(g.y+=.5),f.x===g.x&&f.y===g.y||b.insert(new Path(f,g))}else"'"===a(d,e)&&("-"===a(d-1,e)&&"_"===a(d+1,e-1)&&!isSolidVLineOrJumpOrPoint(a(d-1,e-1))||"_"===a(d-1,e-1)&&"-"===a(d+1,e)&&!isSolidVLineOrJumpOrPoint(a(d+1,e-1)))?b.insert(new Path(Vec2(d,e-.5),Vec2(d,e))):"."===a(d,e)&&("_"===a(d-1,e)&&"-"===a(d+1,e)&&!isSolidVLineOrJumpOrPoint(a(d+1,e+1))||"-"===a(d-1,e)&&"_"===a(d+1,e)&&!isSolidVLineOrJumpOrPoint(a(d-1,e+1)))&&b.insert(new Path(Vec2(d,e),Vec2(d,e+.5)));for(var e=0;e<a.height;++e)for(var d=0;d<a.width;++d)if(a.isSolidHLineAt(d,e)){var f=Vec2(d,e);do a.setUsed(d,e),++d;while(a.isSolidHLineAt(d,e));var g=Vec2(d-1,e);!isVertex(a(f.x-1,f.y))&&(isTopVertex(a(f))&&isSolidVLineOrJumpOrPoint(a(f.x-1,f.y+1))||isBottomVertex(a(f))&&isSolidVLineOrJumpOrPoint(a(f.x-1,f.y-1)))&&++f.x,!isVertex(a(g.x+1,g.y))&&(isTopVertex(a(g))&&isSolidVLineOrJumpOrPoint(a(g.x+1,g.y+1))||isBottomVertex(a(g))&&isSolidVLineOrJumpOrPoint(a(g.x+1,g.y-1)))&&--g.x,f.x===g.x&&f.y===g.y||b.insert(new Path(f,g))}for(var l=-a.height;l<a.width;++l)for(var d=l,e=0;e<a.height;++e,++d)if(a.isSolidBLineAt(d,e)){var f=Vec2(d,e);do++d,++e;while(a.isSolidBLineAt(d,e));var g=Vec2(d-1,e-1);if(c(f,g,"\\")){for(var m=f.x;m<=g.x;++m)a.setUsed(m,f.y+(m-f.x));var n=a(f),h=a(f.x,f.y-1),o=a(f.x-1,f.y-1);"/"===h||"_"===o||"_"===h||!isVertex(n)&&(isSolidHLine(o)||isSolidVLine(o))?(f.x-=.5,f.y-=.5):isPoint(o)&&(f.x-=.25,f.y-=.25);var q=(a(g),a(g.x+1,g.y+1));"/"===a(g.x,g.y+1)||"_"===a(g.x+1,g.y)||"_"===a(g.x-1,g.y)||!isVertex(a(g))&&(isSolidHLine(q)||isSolidVLine(q))?(g.x+=.5,g.y+=.5):isPoint(q)&&(g.x+=.25,g.y+=.25),b.insert(new Path(f,g))}}for(var l=-a.height;l<a.width;++l)for(var d=l,e=a.height-1;e>=0;--e,++d)if(a.isSolidDLineAt(d,e)){var f=Vec2(d,e);do++d,--e;while(a.isSolidDLineAt(d,e));var g=Vec2(d-1,e+1);if(c(f,g,"/")){for(var m=f.x;m<=g.x;++m)a.setUsed(m,f.y-(m-f.x));var h=a(g.x,g.y-1),r=a(g.x+1,g.y-1);a(g);"\\"===h||"_"===h||"_"===r||!isVertex(a(g))&&(isSolidHLine(r)||isSolidVLine(r))?(g.x+=.5,g.y-=.5):isPoint(r)&&(g.x+=.25,g.y-=.25);var s=a(f.x-1,f.y+1),n=a(f);"\\"===a(f.x,f.y+1)||"_"===a(f.x-1,f.y)||"_"===a(f.x+1,f.y)||!isVertex(a(f))&&(isSolidHLine(s)||isSolidVLine(s))?(f.x-=.5,f.y+=.5):isPoint(s)&&(f.x-=.25,f.y+=.25),b.insert(new Path(f,g))}}for(var e=0;e<a.height;++e)for(var d=0;d<a.width;++d){var t=a(d,e);isTopVertex(t)&&(isSolidHLine(a(d-1,e))&&isSolidVLine(a(d+1,e+1))&&(a.setUsed(d-1,e),a.setUsed(d,e),a.setUsed(d+1,e+1),b.insert(new Path(Vec2(d-1,e),Vec2(d+1,e+1),Vec2(d+1.1,e),Vec2(d+1,e+1)))),isSolidHLine(a(d+1,e))&&isSolidVLine(a(d-1,e+1))&&(a.setUsed(d-1,e+1),a.setUsed(d,e),a.setUsed(d+1,e),b.insert(new Path(Vec2(d+1,e),Vec2(d-1,e+1),Vec2(d-1.1,e),Vec2(d-1,e+1))))),")"!==t&&!isPoint(t)||"."!==a(d-1,e-1)||"'"!==a(d-1,e+1)||(a.setUsed(d,e),a.setUsed(d-1,e-1),a.setUsed(d-1,e+1),b.insert(new Path(Vec2(d-2,e-1),Vec2(d-2,e+1),Vec2(d+.6,e-1),Vec2(d+.6,e+1)))),"("!==t&&!isPoint(t)||"."!==a(d+1,e-1)||"'"!==a(d+1,e+1)||(a.setUsed(d,e),a.setUsed(d+1,e-1),a.setUsed(d+1,e+1),b.insert(new Path(Vec2(d+2,e-1),Vec2(d+2,e+1),Vec2(d-.6,e-1),Vec2(d-.6,e+1)))),isBottomVertex(t)&&(isSolidHLine(a(d-1,e))&&isSolidVLine(a(d+1,e-1))&&(a.setUsed(d-1,e),a.setUsed(d,e),a.setUsed(d+1,e-1),b.insert(new Path(Vec2(d-1,e),Vec2(d+1,e-1),Vec2(d+1.1,e),Vec2(d+1,e-1)))),isSolidHLine(a(d+1,e))&&isSolidVLine(a(d-1,e-1))&&(a.setUsed(d-1,e-1),a.setUsed(d,e),a.setUsed(d+1,e),b.insert(new Path(Vec2(d+1,e),Vec2(d-1,e-1),Vec2(d-1.1,e),Vec2(d-1,e-1)))))}for(var e=0;e<a.height;++e)for(var d=0;d<a.width-2;++d){var u=a(d-1,e);if(!("_"!==a(d,e)||"_"!==a(d+1,e)||isASCIILetter(a(d+2,e))&&"_"!==u||isASCIILetter(u)&&"_"!==a(d+2,e))){var v=a(d-2,e),f=Vec2(d-.5,e+.5);"|"===u||"|"===a(d-1,e+1)||"."===u||"'"===a(d-1,e+1)?(f.x-=.5,"."!==u||"-"!==v&&"."!==v||"("!==a(d-2,e+1)||(f.x-=.5)):"/"===u&&(f.x-=1),"("===u&&"("===v&&"'"===a(d,e+1)&&"."===a(d,e-1)&&(f.x+=.5),u=v=void 0;do a.setUsed(d,e),++d;while("_"===a(d,e));var g=Vec2(d-.5,e+.5),t=a(d,e),w=a(d+1,e),j=a(d,e+1);"|"===t||"|"===j||"."===t||"'"===j?(g.x+=.5,"."!==t||"-"!==w&&"."!==w||")"!==a(d+1,e+1)||(g.x+=.5)):"\\"===t&&(g.x+=1),")"===t&&")"===w&&"'"===a(d-1,e+1)&&"."===a(d-1,e-1)&&(g.x+=-.5),b.insert(new Path(f,g))}}}var _=String.prototype;_.rp=_.replace,_.ss=_.substring;var DIAGRAM_MARKER="*",DIAGRAM_START=Array(77).join(DIAGRAM_MARKER),max=Math.max,min=Math.min,abs=Math.abs,sign=Math.sign||function(a){return+a===a?0===a?a:a>0?1:-1:NaN},DEBUG_SHOW_GRID=!1,DEBUG_SHOW_SOURCE=DEBUG_SHOW_GRID,DEBUG_HIDE_PASSTHROUGH=DEBUG_SHOW_SOURCE,x=document.getElementsByClassName("markdeep-diagram");for(a=0;a<x.length;a++){var item=x.item(a);item.innerHTML=replaceDiagrams(item.innerHTML)}
